{"version":3,"file":"formbuilder-conditional-logic.umd.cjs","sources":["../src/plugin/builder.ts","../src/renderer/setup.ts"],"sourcesContent":["// src/plugin/builder.ts\n/**\n * Builder plugin for formBuilder: adds Conditional Logic panel and Groups modal.\n * Exports:\n *  - withConditionalLogic(opts) â†’ formBuilder options extension\n *  - attachLogicGroupsManager(toolbarEl, hooks)\n */\ntype UserAttrs = Record<string, any>;\n\nexport interface FieldMeta {\n    name: string;\n    type: string;\n    label?: string;\n    values?: Array<{ label: string; value: string }>;\n}\n\nexport interface BuilderInitOptions {\n    panelTitle?: string;\n    types?: string[];\n    getAvailableFields?: () => FieldMeta[];\n    getFieldValues?: (fieldName: string) => Array<{ label: string; value: string }> | null;\n    enableVisualEditor?: boolean;\n}\n\nconst DEFAULT_TYPES = [\n    'text', 'textarea', 'number', 'select', 'radio-group', 'checkbox-group',\n    'date', 'paragraph', 'header', 'file', 'autocomplete'\n];\n\n// -------------------------------------------------------------\n// Utility: safely read option values for a field from schema\n// Works even if inferFieldsFromBuilderJson() isn't present.\n// -------------------------------------------------------------\ntype FbChoice = { value?: string | number; label?: string; text?: string };\ntype FbField = { name?: string; label?: string; type?: string; values?: FbChoice[]; options?: FbChoice[] };\n\nfunction getFieldValuesSafe(forField: string): Array<{ value: string; label: string }> {\n    try {\n        // Prefer a project-provided helper if it exists, otherwise fallback to empty\n        const fields: FbField[] =\n            ((globalThis as any).inferFieldsFromBuilderJson?.() ?? []) as FbField[];\n\n        const f = fields.find(x => x?.name === forField);\n        const raw = (f?.values ?? f?.options ?? []) as FbChoice[];\n\n        return raw\n            .map((x: FbChoice) => {\n                const value =\n                    (typeof x?.value === 'number' ? String(x.value) : (x?.value as string)) ?? '';\n                const label = (x?.label ?? x?.text ?? value) as string;\n                return { value, label };\n            })\n            .filter(x => x.value !== '');\n    } catch {\n        return [];\n    }\n}\n\n\n\n/** Build the options object to pass into $('.build-wrap').formBuilder(...) */\nexport function withConditionalLogic(opts: BuilderInitOptions = {}) {\n    const panelTitle = opts.panelTitle || 'Conditional Logic';\n    const types = (opts.types && opts.types.length ? opts.types : DEFAULT_TYPES);\n    const enableVE = opts.enableVisualEditor !== false;\n\n    // 1) inject custom user attrs so formBuilder shows inputs in the field edit panel\n    const typeUserAttrs: Record<string, UserAttrs> = {};\n    types.forEach(t => {\n        typeUserAttrs[t] = {\n            logic: {\n                label: `${panelTitle} (JSON)`,\n                type: 'textarea',\n                value: '',\n                placeholder: '{ \"groups\":[...], \"actions\":[\"show\"] }'\n            },\n            logicApplyTo: {\n                label: `${panelTitle}: Apply To`,\n                type: 'select',\n                value: 'self',\n                options: {\n                    self: 'This Field',\n                    container: 'Field Container',\n                    group: 'Logic Group (below)'\n                }\n            },\n            logicGroup: {\n                label: `${panelTitle}: Group ID`,\n                type: 'text',\n                value: '',\n                placeholder: 'e.g., vehicleDetails'\n            }\n        };\n    });\n\n    function inferFieldsFromBuilderJson(): FieldMeta[] {\n        try {\n            const stage = (window as any).jQuery?.('.build-wrap');\n            const inst = stage?.data('formBuilder');\n            const json = inst?.actions?.getData?.('json');\n            const arr = typeof json === 'string' ? JSON.parse(json) : (Array.isArray(json) ? json : []);\n            return arr.filter((f: any) => f?.name).map((f: any) => ({\n                name: f.name,\n                type: f.type,\n                label: f.label,\n                values: Array.isArray(f.values)\n                    ? f.values.map((v: any) => ({ label: v.label ?? v.value, value: v.value }))\n                    : undefined\n            }));\n        } catch { return []; }\n    }\n\n    const getFields = (): FieldMeta[] => {\n        try {\n            const custom = opts.getAvailableFields?.();\n            if (custom && custom.length) return custom;\n        } catch { }\n        return inferFieldsFromBuilderJson();\n    };\n\n    const getValuesFor = (fieldName: string): Array<{ label: string; value: string }> | null => {\n        try {\n            const custom = opts.getFieldValues?.(fieldName);\n            if (custom) return custom;\n        } catch { }\n        const fm = getFields().find(f => f.name === fieldName);\n        return fm?.values ?? null;\n    };\n\n    /** Build the little visual-editor that writes JSON into the textarea */\n    function makeVE(\n        htmlParent: HTMLElement,\n        getTextArea: () => HTMLTextAreaElement,\n        getApplyTo: () => HTMLSelectElement,\n        getGroupId: () => HTMLInputElement\n    ) {\n        // container\n        const ve = document.createElement('div');\n        ve.className = 'fb-logic-ve';\n        ve.style.marginBottom = '8px';\n\n        // header\n        const hdr = document.createElement('div');\n        hdr.style.display = 'flex';\n        hdr.style.gap = '6px';\n        hdr.style.alignItems = 'center';\n        const title = document.createElement('strong');\n        title.textContent = 'Conditional Logic (Visual)';\n        const tip = document.createElement('span');\n        tip.style.fontSize = '12px';\n        tip.style.opacity = '0.7';\n        tip.textContent = 'â€” use this editor then save to JSON below';\n        hdr.appendChild(title);\n        hdr.appendChild(tip);\n        ve.appendChild(hdr);\n\n        // body\n        const veBody = document.createElement('div');\n        veBody.className = 'fb-logic-ve-body';\n        veBody.style.border = '1px dashed #cbd5e1';\n        veBody.style.padding = '8px';\n        veBody.style.marginTop = '6px';\n        ve.appendChild(veBody);\n\n        // mode\n        const modeWrap = document.createElement('div');\n        modeWrap.style.margin = '6px 0';\n        modeWrap.innerHTML = `\n    <label style=\"margin-right:8px;\">Mode</label>\n    <select class=\"ve-mode form-select form-select-sm\" style=\"display:inline-block; width:auto;\">\n      <option value=\"any\">ANY (OR)</option>\n      <option value=\"all\">ALL (AND)</option>\n    </select>\n  `;\n        veBody.appendChild(modeWrap);\n\n        // actions\n        const actionsWrap = document.createElement('div');\n        actionsWrap.style.margin = '6px 0';\n        actionsWrap.innerHTML = `\n    <label style=\"margin-right:8px;\">Actions</label>\n    <label class=\"form-check form-check-inline\"><input class=\"ve-act form-check-input\" type=\"checkbox\" value=\"show\" checked> <span class=\"form-check-label\">show</span></label>\n    <label class=\"form-check form-check-inline\"><input class=\"ve-act form-check-input\" type=\"checkbox\" value=\"require\"> <span class=\"form-check-label\">require</span></label>\n    <label class=\"form-check form-check-inline\"><input class=\"ve-act form-check-input\" type=\"checkbox\" value=\"enable\"> <span class=\"form-check-label\">enable</span></label>\n    <label class=\"form-check form-check-inline\"><input class=\"ve-act form-check-input\" type=\"checkbox\" value=\"disable\"> <span class=\"form-check-label\">disable</span></label>\n    <label class=\"form-check form-check-inline\"><input class=\"ve-act form-check-input\" type=\"checkbox\" value=\"hide\"> <span class=\"form-check-label\">hide</span></label>\n  `;\n        veBody.appendChild(actionsWrap);\n\n        // rules list\n        const rules = document.createElement('div');\n        rules.className = 've-rules';\n        rules.style.marginTop = '6px';\n        rules.style.display = 'grid';\n        rules.style.gap = '6px';\n        veBody.appendChild(rules);\n\n        // footer: Add rule + Save (moved here)\n        const footer = document.createElement('div');\n        footer.style.display = 'flex';\n        footer.style.justifyContent = 'flex-end';\n        footer.style.gap = '8px';\n        footer.style.marginTop = '8px';\n\n        const addBtn = document.createElement('button');\n        addBtn.type = 'button';\n        addBtn.className = 'btn btn-sm btn-outline-secondary';\n        addBtn.textContent = 'Add rule';\n\n        const save = document.createElement('button');\n        save.type = 'button';\n        save.className = 'btn btn-sm btn-primary';\n        save.textContent = 'Save to JSON';\n\n        footer.appendChild(addBtn);\n        footer.appendChild(save);\n        veBody.appendChild(footer);\n\n        // helpers that always read the latest fields/values\n        const getFieldsNow = (): Array<{ name: string; label?: string; type?: string; values?: { label: string; value: string }[] }> => {\n            try {\n                // Prefer provider the builder passed to withConditionalLogic()\n                const stage = (window as any).jQuery?.('.build-wrap');\n                const inst = stage?.data?.('formBuilder');\n                const data = inst?.actions?.getData?.('json');\n                const arr = typeof data === 'string' ? JSON.parse(data) : (Array.isArray(data) ? data : []);\n                return arr.filter((f: any) => f?.name).map((f: any) => ({\n                    name: f.name, type: f.type, label: f.label,\n                    values: Array.isArray(f.values) ? f.values.map((v: any) => ({ label: v.label ?? v.value, value: v.value })) : undefined\n                }));\n            } catch { return []; }\n        };\n\n        const getChoicesFor = (fieldName: string) => {\n            const fm = getFieldsNow().find(f => f.name === fieldName);\n            return fm?.values ?? null;\n        };\n\n        const buildFieldSelect = () => {\n            const sel = document.createElement('select');\n            sel.className = 've-field form-select form-select-sm';\n            sel.style.minWidth = '160px';\n            const fields = getFieldsNow();\n            if (!fields.length) {\n                const opt = document.createElement('option');\n                opt.value = '';\n                opt.textContent = '(no fields yet)';\n                sel.appendChild(opt);\n            } else {\n                fields.forEach(f => {\n                    const opt = document.createElement('option');\n                    opt.value = f.name;\n                    opt.textContent = f.label ? `${f.label} (${f.name})` : f.name;\n                    sel.appendChild(opt);\n                });\n            }\n            return sel;\n        };\n\n        const buildOpSelect = (forField: string) => {\n            const sel = document.createElement('select');\n            sel.className = 've-op form-select form-select-sm';\n            sel.style.minWidth = '140px';\n            const fm = getFieldsNow().find(f => f.name === forField);\n            const isNum = fm?.type === 'number';\n            const isChoice = fm?.type === 'radio-group' || fm?.type === 'select' || !!fm?.values?.length;\n            const ops = isNum\n                ? ['equals', 'notEquals', 'gt', 'gte', 'lt', 'lte', 'isEmpty', 'notEmpty']\n                : isChoice\n                    ? ['equals', 'notEquals', 'isEmpty', 'notEmpty']\n                    : ['equals', 'notEquals', 'contains', 'startsWith', 'endsWith', 'isEmpty', 'notEmpty'];\n            sel.innerHTML = '';\n            ops.forEach(o => {\n                const opt = document.createElement('option');\n                opt.value = o;\n                opt.textContent = o;\n                sel.appendChild(opt);\n            });\n            return sel;\n        };\n\n        const buildValueInput = (forField: string, current?: string) => {\n            const choices = getChoicesFor(forField);\n            if (choices && choices.length) {\n                const sel = document.createElement('select');\n                sel.className = 've-value form-select form-select-sm';\n                choices.forEach((v: { value: string; label: string }) => {\n                    const opt = document.createElement('option');\n                    opt.value = v.value;\n                    opt.textContent = v.label ?? v.value;\n                    sel.appendChild(opt);\n                });\n                if (current != null) sel.value = current;\n                return sel;\n            }\n            const input = document.createElement('input');\n            input.className = 've-value form-control form-control-sm';\n            input.type = 'text';\n            if (current != null) input.value = current;\n            return input;\n        };\n\n        function row(field?: string, op?: string, value?: string) {\n            const row = document.createElement('div');\n            row.className = 've-row';\n            row.style.display = 'flex';\n            row.style.gap = '6px';\n            row.style.alignItems = 'center';\n\n            const fSel = buildFieldSelect();\n            const initialField = field || (fSel.options[0]?.value || '');\n            const oSel = buildOpSelect(initialField);\n            const vWrap = document.createElement('div');\n\n            const renderValue = (fn: string, val?: string) => {\n                vWrap.innerHTML = '';\n                vWrap.appendChild(buildValueInput(fn, val));\n            };\n\n            // initialize row\n            if (field) fSel.value = field;\n            renderValue(fSel.value);\n            if (op) {\n                // rebuild ops based on chosen field\n                const newOps = buildOpSelect(fSel.value);\n                oSel.innerHTML = newOps.innerHTML;\n                oSel.value = op;\n            }\n            if (value != null) {\n                (vWrap.querySelector('.ve-value') as HTMLInputElement | HTMLSelectElement).value = value;\n            }\n\n            fSel.addEventListener('change', () => {\n                const newOps = buildOpSelect(fSel.value);\n                oSel.innerHTML = newOps.innerHTML;\n                renderValue(fSel.value);\n            });\n\n            row.appendChild(fSel);\n            row.appendChild(oSel);\n            row.appendChild(vWrap);\n\n            const rm = document.createElement('button');\n            rm.type = 'button';\n            rm.className = 'btn btn-sm btn-outline-danger';\n            rm.textContent = 'Remove';\n            rm.addEventListener('click', () => row.remove());\n            row.appendChild(rm);\n\n            rules.appendChild(row);\n        }\n\n        addBtn.addEventListener('click', () => row());\n\n        save.addEventListener('click', () => {\n            const _mode = (veBody.querySelector('.ve-mode') as HTMLSelectElement).value as 'any' | 'all';\n            const _actions = Array.from(veBody.querySelectorAll('.ve-act') as NodeListOf<HTMLInputElement>)\n                .filter(i => i.checked)\n                .map(i => i.value) as Array<'show' | 'hide' | 'enable' | 'disable' | 'require'>;\n\n            const ruleRows = Array.from(veBody.querySelectorAll('.ve-row'));\n            const rulesCfg = ruleRows.map(r => {\n                const f = (r.querySelector('.ve-field') as HTMLSelectElement).value;\n                const o = (r.querySelector('.ve-op') as HTMLSelectElement).value;\n                const valEl = (r.querySelector('.ve-value') as HTMLInputElement | HTMLSelectElement);\n                const v = (valEl as any).value ?? '';\n                return { field: f, op: o as any, value: v };\n            });\n\n            const cfg = { groups: [{ mode: _mode, rules: rulesCfg, actions: _actions }] };\n            const ta = (getTextArea() as any) as HTMLTextAreaElement | null;\n            if (ta) {\n                ta.value = JSON.stringify(cfg, null, 2);\n                alert('Conditional Logic JSON updated.');\n            } else {\n                alert('Could not find the logic JSON field to update.');\n            }\n        });\n\n        // Preload from JSON (null-safe)\n        try {\n            const ta = (getTextArea() as any) as HTMLTextAreaElement | null;\n            const raw = (ta && ta.value) || '';\n            if (raw && raw.trim()) {\n                const parsed = JSON.parse(raw);\n                const g = Array.isArray(parsed.groups) ? parsed.groups[0] : null;\n                if (g) {\n                    (veBody.querySelector('.ve-mode') as HTMLSelectElement).value = g.mode || 'any';\n                    const acts = new Set((g.actions || []) as string[]);\n                    veBody.querySelectorAll('.ve-act').forEach((i: any) => { i.checked = acts.has(i.value); });\n                    (g.rules || []).forEach((r: any) => row(r.field, r.op, r.value));\n                }\n            }\n        } catch { /* ignore */ }\n\n        htmlParent.prepend(ve);\n    }\n\n\n    function onOpenFieldEdit(editPanel: HTMLElement) {\n        const logicControls = Array.from(\n            editPanel.querySelectorAll('[name=\"logic\"], [name=\"logicApplyTo\"], [name=\"logicGroup\"]')\n        ) as HTMLElement[];\n        if (!logicControls.length) return;\n\n        let section = editPanel.querySelector('.fb-logic-section') as HTMLElement | null;\n        if (!section) {\n            section = document.createElement('div');\n            section.className = 'fb-logic-section';\n            section.innerHTML = `\n      <div class=\"fb-logic-header\" style=\"margin-top:8px; font-weight:600; cursor:pointer;\">\n        ${panelTitle}\n        <span style=\"font-weight:400; font-size:12px; opacity:.7\"> (toggle)</span>\n      </div>\n      <div class=\"fb-logic-body\" style=\"border:1px solid #e5e7eb; padding:8px; margin-top:6px; display:none;\"></div>\n    `;\n            editPanel.appendChild(section);\n            const header = section.querySelector('.fb-logic-header') as HTMLElement;\n            const body0 = section.querySelector('.fb-logic-body') as HTMLElement;\n            header.addEventListener('click', () => {\n                const open = body0.style.display !== 'none';\n                body0.style.display = open ? 'none' : '';\n            });\n        }\n\n        const body = section!.querySelector('.fb-logic-body') as HTMLElement;\n\n        // --- Advanced (JSON) panel FIRST ---\n        let adv = body.querySelector('.fb-logic-advanced') as HTMLElement | null;\n        if (!adv) {\n            adv = document.createElement('div');\n            adv.className = 'fb-logic-advanced';\n            adv.innerHTML = `\n      <div class=\"fb-logic-adv-header\" style=\"margin-top:10px; font-weight:600; cursor:pointer;\">\n        Advanced (JSON)\n        <span style=\"font-weight:400; font-size:12px; opacity:.7\"> (toggle)</span>\n      </div>\n      <div class=\"fb-logic-adv-body\" style=\"border:1px dashed #cbd5e1; padding:8px; margin-top:6px; display:none;\"></div>\n    `;\n            body.appendChild(adv);\n            const advHeader = adv.querySelector('.fb-logic-adv-header') as HTMLElement;\n            const advBody = adv.querySelector('.fb-logic-adv-body') as HTMLElement;\n            advHeader.addEventListener('click', () => {\n                const open = advBody.style.display !== 'none';\n                advBody.style.display = open ? 'none' : '';\n            });\n        }\n\n        // Move native controls inside Advanced body\n        const advBody = adv!.querySelector('.fb-logic-adv-body') as HTMLElement;\n        logicControls.forEach(el => {\n            const row = el.closest('.form-group') || el.closest('div') || el;\n            if (row && row.parentElement !== advBody) advBody.appendChild(row as HTMLElement);\n        });\n        // De-dup (defensive)\n        const seen = new Set<string>();\n        advBody.querySelectorAll<HTMLElement>('[name=\"logic\"], [name=\"logicApplyTo\"], [name=\"logicGroup\"]').forEach(ctrl => {\n            const n = ctrl.getAttribute('name')!;\n            if (seen.has(n)) {\n                const dupRow = ctrl.closest('.form-group') || ctrl.closest('div') || ctrl;\n                if (dupRow && dupRow.parentElement === advBody) (dupRow as HTMLElement).remove();\n            } else {\n                seen.add(n);\n            }\n        });\n\n        // --- Visual Editor AFTER controls exist ---\n        if (enableVE) {\n            const getTextArea = () => body.querySelector('[name=\"logic\"]') as HTMLTextAreaElement;\n            const getApplyTo = () => body.querySelector('[name=\"logicApplyTo\"]') as HTMLSelectElement;\n            const getGroupId = () => body.querySelector('[name=\"logicGroup\"]') as HTMLInputElement;\n\n            if (!body.querySelector('.fb-logic-ve')) {\n                const dupes = body.querySelectorAll('.fb-logic-ve');\n                if (dupes.length > 1) dupes.forEach((el, idx) => { if (idx > 0) el.remove(); });\n                makeVE(body, getTextArea, getApplyTo, getGroupId);\n            }\n        }\n    }\n\n\n    return { typeUserAttrs, onOpenFieldEdit };\n}\n\n/** Minimal Groups GUI living in a modal attached to a toolbar element */\nexport function attachLogicGroupsManager(\n    targetContainer: HTMLElement,\n    initialOrOpts?: string | {\n        initialJson?: string;\n        getAvailableFields?: () => FieldMeta[];\n        getFieldValues?: (fieldName: string) => Array<{ label: string; value: string }> | null;\n    }\n) {\n    const opts = (typeof initialOrOpts === 'string') ? { initialJson: initialOrOpts } : (initialOrOpts || {});\n    const state = { json: opts.initialJson || '' };\n\n    // ---- Helpers to obtain fields/values ----\n    function inferFieldsFromBuilderJson(): FieldMeta[] {\n        try {\n            const $stage = (window as any).jQuery?.('.build-wrap');\n            const fb = $stage?.data?.('formBuilder');\n            const data = fb?.actions?.getData?.('json');\n            const arr = typeof data === 'string' ? JSON.parse(data) : (Array.isArray(data) ? data : []);\n            return arr.filter((f: any) => f?.name).map((f: any) => ({\n                name: f.name, type: f.type, label: f.label,\n                values: Array.isArray(f.values) ? f.values.map((v: any) => ({ label: v.label ?? v.value, value: v.value })) : undefined\n            }));\n        } catch { return []; }\n    }\n    const getFields = (): FieldMeta[] => {\n        try { const x = opts.getAvailableFields?.(); if (x && x.length) return x; } catch { }\n        return inferFieldsFromBuilderJson();\n    };\n    const getValuesFor = (fieldName: string) => {\n        try { const x = opts.getFieldValues?.(fieldName); if (x) return x; } catch { }\n        const fm = getFields().find(f => f.name === fieldName);\n        return fm?.values ?? null;\n    };\n\n    // ---- UI scaffold: button + modal ----\n    const wrapper = document.createElement('div');\n    wrapper.style.margin = '8px 0';\n    wrapper.innerHTML = `\n    <button type=\"button\" class=\"btn btn-sm btn-outline-primary\">Logic Groups</button>\n    <div class=\"fb-logic-modal\" style=\"display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:99999;\">\n      <div style=\"background:#fff; max-width:900px; width:92%; margin:4% auto; padding:16px; border-radius:8px;\">\n        <div style=\"display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:8px;\">\n          <strong style=\"font-size:16px;\">Logic Groups</strong>\n          <div style=\"display:flex; gap:8px;\">\n            <button type=\"button\" class=\"btn btn-sm btn-secondary fb-groups-load-sample\">Load sample</button>\n            <button type=\"button\" class=\"btn btn-sm btn-outline-secondary fb-groups-from-json\">From JSON</button>\n            <button type=\"button\" class=\"btn btn-sm btn-primary fb-groups-save\">Save</button>\n            <button type=\"button\" class=\"btn btn-sm btn-light fb-logic-close\">Close</button>\n          </div>\n        </div>\n\n        <div class=\"fb-groups-ve-header\" style=\"font-weight:600;\">Visual Groups Editor\n          <span style=\"font-size:12px;opacity:.7;font-weight:400;\">(no JSON typing)</span>\n        </div>\n        <div class=\"fb-groups-ve-body\" style=\"border:1px dashed #cbd5e1; padding:8px; margin-top:6px;\">\n          <div class=\"fb-groups-list\"></div>\n          <button type=\"button\" class=\"btn btn-sm btn-outline-primary fb-groups-add\" style=\"margin-top:8px;\">Add group</button>\n        </div>\n\n        <div class=\"fb-groups-adv\" style=\"margin-top:10px;\">\n          <div class=\"fb-groups-adv-header\" style=\"font-weight:600; cursor:pointer;\">\n            Advanced (JSON)\n            <span style=\"font-size:12px;opacity:.7;font-weight:400;\">(toggle)</span>\n          </div>\n          <div class=\"fb-groups-adv-body\" style=\"border:1px dashed #cbd5e1; padding:8px; margin-top:6px; display:none;\">\n            <p style=\"font-size:12px; margin:0 0 6px 0; opacity:.75;\">Define reusable groups keyed by ID.</p>\n            <textarea class=\"fb-logic-json\" style=\"width:100%; height:240px; font-family:monospace;\"></textarea>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n    targetContainer.prepend(wrapper);\n\n    const btn = wrapper.querySelector('button') as HTMLButtonElement;\n    const modal = wrapper.querySelector('.fb-logic-modal') as HTMLDivElement;\n    const closeBtn = modal.querySelector('.fb-logic-close') as HTMLButtonElement;\n    const loadBtn = modal.querySelector('.fb-groups-load-sample') as HTMLButtonElement;\n    const saveBtn = modal.querySelector('.fb-groups-save') as HTMLButtonElement;\n    const fromJson = modal.querySelector('.fb-groups-from-json') as HTMLButtonElement;\n    const advHdr = modal.querySelector('.fb-groups-adv-header') as HTMLDivElement;\n    const advBody = modal.querySelector('.fb-groups-adv-body') as HTMLDivElement;\n    const ta = modal.querySelector('.fb-logic-json') as HTMLTextAreaElement;\n    const listEl = modal.querySelector('.fb-groups-list') as HTMLDivElement;\n    const addGroupBtn = modal.querySelector('.fb-groups-add') as HTMLButtonElement;\n\n    const open = () => {\n        // Seed from window or current state\n        const srcObj = (window as any).fbLogicGroups && typeof (window as any).fbLogicGroups === 'object'\n            ? (window as any).fbLogicGroups\n            : (state.json ? safeParse(state.json) : {});\n        state.json = JSON.stringify(srcObj || {}, null, 2);\n        ta.value = state.json;\n        renderFromJson(srcObj || {});\n        modal.style.display = 'block';\n    };\n    const close = () => { modal.style.display = 'none'; };\n\n    btn.addEventListener('click', open);\n    closeBtn.addEventListener('click', close);\n    modal.addEventListener('click', (e) => { if (e.target === modal) close(); });\n\n    advHdr.addEventListener('click', () => {\n        const isOpen = advBody.style.display !== 'none';\n        advBody.style.display = isOpen ? 'none' : '';\n    });\n\n    loadBtn.addEventListener('click', () => {\n        const fields = getFields();\n        const first = fields[0]?.name || 'controller';\n        const obj = {\n            vehicleDetails: {\n                mode: 'any',\n                rules: [{ field: first, op: 'equals', value: 'yes' }],\n                actions: ['show', 'require']\n            }\n        };\n        ta.value = JSON.stringify(obj, null, 2);\n        renderFromJson(obj);\n    });\n\n    fromJson.addEventListener('click', () => {\n        const parsed = safeParse(ta.value) || {};\n        renderFromJson(parsed);\n    });\n\n    // ðŸ” SAVE: keep UI intact (no setData). Persist to window + patch export.\n    saveBtn.addEventListener('click', () => {\n        const obj = collectFromVe();\n        state.json = JSON.stringify(obj, null, 2);\n        ta.value = state.json;\n        (window as any).fbLogicGroups = obj;\n\n        // Patch export so JSON returned by getData('json') contains __logicGroups (no rebuild).\n        try {\n            const $stage = (window as any).jQuery?.('.build-wrap');\n            const fb = $stage?.data?.('formBuilder');\n            if (fb?.actions?.getData && !(fb as any).__fbLogicGroupsPatched) {\n                const origGetData = fb.actions.getData.bind(fb.actions);\n                (fb as any).__fbLogicGroupsPatched = true;\n\n                fb.actions.getData = (mode?: string) => {\n                    const out = origGetData(mode as any);\n                    if (mode !== 'json') return out;\n\n                    // always read the latest groups from window or state\n                    const groupsObj = (window as any).fbLogicGroups || (safeParse(state.json) || {});\n                    const groupsStr = JSON.stringify(groupsObj);\n\n                    try {\n                        const arr = typeof out === 'string' ? JSON.parse(out) : (Array.isArray(out) ? out : []);\n                        const idx = arr.findIndex((f: any) => f?.type === 'hidden' && (f?.name === '__logicGroups' || f?.name === 'logicGroups'));\n                        const fieldObj = { type: 'hidden', name: '__logicGroups', value: groupsStr, label: ' ', access: false, className: 'd-none' };\n                        if (idx >= 0) arr[idx] = { ...arr[idx], ...fieldObj };\n                        else arr.push(fieldObj);\n                        return JSON.stringify(arr);\n                    } catch {\n                        // if something goes off, just return original\n                        return out;\n                    }\n                };\n            }\n        } catch (e) {\n            console.warn('[logic-groups] export patch failed', e);\n        }\n\n        alert('Logic groups saved (no rebuild). They will be embedded into exported JSON automatically.');\n        close();\n    });\n\n    // âž• Add group now works reliably\n    addGroupBtn.addEventListener('click', () => addGroupBlock());\n\n    // ---- Helpers ----\n    function safeParse(txt: string): any | null { try { return JSON.parse(txt); } catch { return null; } }\n    function clearChildren(node: HTMLElement) { while (node.firstChild) node.removeChild(node.firstChild); }\n\n    function addGroupBlock(groupId: string = '') {\n        const groupWrap = document.createElement('div');\n        groupWrap.className = 'fb-group-block';\n        groupWrap.style.border = '1px solid #e5e7eb';\n        groupWrap.style.borderRadius = '6px';\n        groupWrap.style.padding = '8px';\n        groupWrap.style.marginTop = '8px';\n\n        // Header: Group ID\n        const header = document.createElement('div');\n        header.style.display = 'grid';\n        header.style.gridTemplateColumns = '1fr auto';\n        header.style.gap = '8px';\n        header.style.alignItems = 'center';\n\n        const idInput = document.createElement('input');\n        idInput.className = 'form-control form-control-sm fb-group-id';\n        idInput.placeholder = 'Group ID (e.g., vehicleDetails)';\n        idInput.value = groupId;\n\n        const delBtn = document.createElement('button');\n        delBtn.type = 'button';\n        delBtn.className = 'btn btn-sm btn-link text-danger';\n        delBtn.textContent = 'remove group';\n        delBtn.addEventListener('click', () => groupWrap.remove());\n\n        header.appendChild(idInput);\n        header.appendChild(delBtn);\n        groupWrap.appendChild(header);\n\n        // Inner body\n        const body = document.createElement('div');\n        body.style.border = '1px dashed #cbd5e1';\n        body.style.padding = '8px';\n        body.style.marginTop = '6px';\n        groupWrap.appendChild(body);\n\n        // Top row\n        const top = document.createElement('div');\n        top.style.display = 'flex';\n        top.style.flexWrap = 'wrap';\n        top.style.gap = '12px';\n        top.style.alignItems = 'center';\n        top.style.marginBottom = '6px';\n\n        const modeLbl = document.createElement('label');\n        modeLbl.textContent = 'Mode';\n        const modeSel = document.createElement('select');\n        modeSel.className = 'form-select form-select-sm fb-group-mode';\n        ['any', 'all'].forEach(v => {\n            const opt = document.createElement('option');\n            opt.value = v;\n            opt.textContent = v.toUpperCase() + (v === 'any' ? ' (OR)' : ' (AND)');\n            modeSel.appendChild(opt);\n        });\n\n        const actionsWrap = document.createElement('div');\n        actionsWrap.innerHTML = `\n      <label style=\"margin-right:8px;\">Actions</label>\n      <label class=\"form-check form-check-inline\"><input class=\"fb-act form-check-input\" type=\"checkbox\" value=\"show\" checked> <span class=\"form-check-label\">show</span></label>\n      <label class=\"form-check form-check-inline\"><input class=\"fb-act form-check-input\" type=\"checkbox\" value=\"require\"> <span class=\"form-check-label\">require</span></label>\n      <label class=\"form-check form-check-inline\"><input class=\"fb-act form-check-input\" type=\"checkbox\" value=\"enable\"> <span class=\"form-check-label\">enable</span></label>\n      <label class=\"form-check form-check-inline\"><input class=\"fb-act form-check-input\" type=\"checkbox\" value=\"disable\"> <span class=\"form-check-label\">disable</span></label>\n      <label class=\"form-check form-check-inline\"><input class=\"fb-act form-check-input\" type=\"checkbox\" value=\"hide\"> <span class=\"form-check-label\">hide</span></label>\n    `;\n\n        top.appendChild(modeLbl);\n        top.appendChild(modeSel);\n        top.appendChild(actionsWrap);\n        body.appendChild(top);\n\n        // Rules list + add button\n        const rulesList = document.createElement('div');\n        rulesList.className = 'fb-group-rules';\n        body.appendChild(rulesList);\n\n        const addRuleBtn = document.createElement('button');\n        addRuleBtn.type = 'button';\n        addRuleBtn.className = 'btn btn-sm btn-outline-secondary';\n        addRuleBtn.textContent = 'Add rule';\n        addRuleBtn.style.marginTop = '8px';\n        body.appendChild(addRuleBtn);\n\n        function addRuleRow(field?: string, op?: string, value?: string) {\n            const row = document.createElement('div');\n            row.className = 'fb-group-rule';\n            row.style.display = 'grid';\n            row.style.gridTemplateColumns = '1fr 1fr 1fr auto';\n            row.style.gap = '6px';\n            row.style.marginTop = '6px';\n\n            // field select\n            const fSel = document.createElement('select');\n            fSel.className = 'form-select form-select-sm fb-rule-field';\n            const fields = getFields();\n            if (!fields.length) {\n                const opt = document.createElement('option');\n                opt.value = '';\n                opt.textContent = '(no fields yet)';\n                fSel.appendChild(opt);\n            } else {\n                fields.forEach(f => {\n                    const opt = document.createElement('option');\n                    opt.value = f.name;\n                    opt.textContent = f.label ? `${f.label} (${f.name})` : f.name;\n                    fSel.appendChild(opt);\n                });\n            }\n            if (field) fSel.value = field;\n\n            // op select (dynamic by type)\n            const oSel = document.createElement('select');\n            oSel.className = 'form-select form-select-sm fb-rule-op';\n            const setOpsForField = (fn: string) => {\n                const fm = getFields().find(f => f.name === fn);\n                const isNum = fm?.type === 'number';\n                const isChoice = fm?.type === 'radio-group' || fm?.type === 'select' || !!fm?.values?.length;\n                const ops = isNum\n                    ? ['equals', 'notEquals', 'gt', 'gte', 'lt', 'lte', 'isEmpty', 'notEmpty']\n                    : isChoice\n                        ? ['equals', 'notEquals', 'isEmpty', 'notEmpty']\n                        : ['equals', 'notEquals', 'contains', 'startsWith', 'endsWith', 'isEmpty', 'notEmpty'];\n                oSel.innerHTML = '';\n                ops.forEach(o => {\n                    const opt = document.createElement('option');\n                    opt.value = o; opt.textContent = o;\n                    oSel.appendChild(opt);\n                });\n            };\n            setOpsForField(fSel.value);\n            if (op) oSel.value = op;\n\n            // value control\n            const vWrap = document.createElement('div');\n            vWrap.className = 'fb-rule-value-wrap';\n            const renderValueControl = (fn: string, current?: string) => {\n                vWrap.innerHTML = '';\n                const choices = getValuesFor(fn);\n                if (choices && choices.length) {\n                    const s = document.createElement('select');\n                    s.className = 'form-select form-select-sm fb-rule-value';\n                    choices.forEach(c => {\n                        const option = document.createElement('option');\n                        option.value = c.value;\n                        option.textContent = c.label ?? c.value;\n                        s.appendChild(option);\n                    });\n                    if (current) s.value = current;\n                    vWrap.appendChild(s);\n                } else {\n                    const i = document.createElement('input');\n                    i.type = 'text';\n                    i.className = 'form-control form-control-sm fb-rule-value';\n                    if (current) i.value = current;\n                    vWrap.appendChild(i);\n                }\n            };\n            renderValueControl(fSel.value, value);\n\n            // interactions\n            fSel.addEventListener('change', () => {\n                setOpsForField(fSel.value);\n                renderValueControl(fSel.value);\n            });\n\n            // remove rule\n            const rm = document.createElement('button');\n            rm.type = 'button';\n            rm.className = 'btn btn-sm btn-outline-danger';\n            rm.textContent = 'Remove';\n            rm.addEventListener('click', () => row.remove());\n\n            // mount\n            row.appendChild(fSel);\n            row.appendChild(oSel);\n            row.appendChild(vWrap);\n            row.appendChild(rm);\n            rulesList.appendChild(row);\n        }\n\n        addRuleBtn.addEventListener('click', () => addRuleRow());\n\n        // allow preset\n        (groupWrap as any)._set = (cfg: { mode?: string; actions?: string[]; rules?: any[] }) => {\n            if (cfg?.mode) (modeSel.value = cfg.mode);\n            const acts = new Set(cfg?.actions || []);\n            actionsWrap.querySelectorAll<HTMLInputElement>('.fb-act').forEach(i => { i.checked = acts.has(i.value); });\n            clearChildren(rulesList);\n            (cfg?.rules || []).forEach((r: any) => addRuleRow(r.field, r.op, r.value));\n        };\n\n        listEl.appendChild(groupWrap);\n        return groupWrap;\n    }\n\n    function renderFromJson(obj: Record<string, any>) {\n        clearChildren(listEl);\n        const keys = Object.keys(obj || {});\n        if (!keys.length) {\n            // UX: start with one blank group\n            addGroupBlock('');\n            return;\n        }\n        keys.forEach(id => {\n            const w = addGroupBlock(id);\n            (w as any)._set(obj[id] || {});\n        });\n    }\n\n    function collectFromVe(): Record<string, any> {\n        const result: Record<string, any> = {};\n        const blocks = listEl.querySelectorAll('.fb-group-block');\n        blocks.forEach((b: Element) => {\n            const id = (b.querySelector('.fb-group-id') as HTMLInputElement).value.trim();\n            if (!id) return;\n            const mode = (b.querySelector('.fb-group-mode') as HTMLSelectElement).value || 'any';\n            const actions = Array.from(b.querySelectorAll('.fb-act') as NodeListOf<HTMLInputElement>)\n                .filter(i => i.checked).map(i => i.value);\n            const rules: Array<{ field: string; op: string; value?: string }> = [];\n            const rows = b.querySelectorAll('.fb-group-rule');\n            rows.forEach((r: Element) => {\n                const field = (r.querySelector('.fb-rule-field') as HTMLSelectElement).value;\n                const op = (r.querySelector('.fb-rule-op') as HTMLSelectElement).value;\n                const vEl = (r.querySelector('.fb-rule-value') as HTMLInputElement | HTMLSelectElement);\n                const value = (vEl as any)?.value ?? '';\n                if (field && op) rules.push({ field, op, value });\n            });\n            result[id] = { mode, rules, actions };\n        });\n        return result;\n    }\n\n    return {\n        getJson: () => state.json,\n        setJson: (j: string) => { state.json = j; },\n        getGroups: () => safeParse(state.json || '{}') || {},\n    };\n}\n\n\n\n","import type { LogicConfig, LogicGroup, Rule, SetupOptions } from '../types';\n\ndeclare global {\n    interface Window {\n        fbLogicGroups?: Record<string, LogicGroup>;\n        __FB_LOGIC_DEBUG__?: boolean;\n        FB_GET_WRAPPER?: (el: HTMLElement) => HTMLElement;\n        _fbLogic?: { refresh: () => void }; // debug handle\n    }\n}\n\n/* ==============================\n   Utilities\n============================== */\n\nfunction cssEscape(name: string) {\n    const CSSObj: any = (window as any).CSS;\n    if (CSSObj && typeof CSSObj.escape === 'function') return CSSObj.escape(name);\n    return name.replace(/([^a-zA-Z0-9_-])/g, '\\\\$1');\n}\n\nfunction sourceSelector(fieldName: string) {\n    const n = cssEscape(fieldName);\n    return `[name=\"${n}\"], [name=\"${n}[]\"], [data-fb-name=\"${n}\"]`;\n}\n\nfunction defaultWrapper(el: HTMLElement): HTMLElement {\n    const candidates = ['.form-group', '.fb-field-wrapper', '.form-field', '.field-wrapper', '.row', '.mb-3', '.box'];\n    for (const c of candidates) {\n        const found = el.closest(c);\n        if (found) return found as HTMLElement;\n    }\n    return el.parentElement || el;\n}\n\nfunction getControlValue(el: HTMLElement): any {\n    if (el instanceof HTMLInputElement) {\n        if (el.type === 'radio') {\n            const name = el.name;\n            const group =\n                el.form?.querySelectorAll(`input[type=\"radio\"][name=\"${name}\"]`) ||\n                document.querySelectorAll(`input[type=\"radio\"][name=\"${name}\"]`);\n            for (const r of Array.from(group)) {\n                const rr = r as HTMLInputElement;\n                if (rr.checked) return rr.value;\n            }\n            return null;\n        }\n        if (el.type === 'checkbox') {\n            const name = el.name;\n            const group =\n                el.form?.querySelectorAll(`input[type=\"checkbox\"][name=\"${name}\"]`) ||\n                document.querySelectorAll(`input[type=\"checkbox\"][name=\"${name}\"]`);\n            const vals: string[] = [];\n            Array.from(group).forEach((cb) => {\n                const cbb = cb as HTMLInputElement;\n                if (cbb.checked) vals.push(cbb.value);\n            });\n            return vals;\n        }\n        return el.value;\n    }\n    if (el instanceof HTMLSelectElement) {\n        if (el.multiple) return Array.from(el.selectedOptions).map((o) => o.value);\n        return el.value;\n    }\n    if (el instanceof HTMLTextAreaElement) return el.value;\n    return (el as any).value ?? (el as any).textContent ?? null;\n}\n\nfunction testRule(value: any, rule: Rule): boolean {\n    const op = rule.op;\n    const expected = rule.value;\n\n    if (Array.isArray(value)) {\n        if (op === 'contains') return value.includes(expected);\n        if (op === 'equals') return value.includes(expected);\n        if (op === 'notEquals') return !value.includes(expected);\n        if (op === 'isEmpty') return value.length === 0;\n        if (op === 'notEmpty') return value.length > 0;\n        return false;\n    }\n\n    const valStr = value == null ? '' : String(value);\n    const expStr = expected == null ? '' : String(expected);\n    const valNum = Number(value);\n    const expNum = Number(expected);\n\n    switch (op) {\n        case 'equals': return value == expected;\n        case 'notEquals': return value != expected;\n        case 'contains': return valStr.includes(expStr);\n        case 'startsWith': return valStr.startsWith(expStr);\n        case 'endsWith': return valStr.endsWith(expStr);\n        case 'gt': return valNum > expNum;\n        case 'gte': return valNum >= expNum;\n        case 'lt': return valNum < expNum;\n        case 'lte': return valNum <= expNum;\n        case 'isEmpty': return valStr.trim() === '';\n        case 'notEmpty': return valStr.trim() !== '';\n        default: return false;\n    }\n}\n\nfunction evalGroup(form: HTMLElement, group: LogicGroup): boolean {\n    const results = group.rules.map((rule) => {\n        const src = form.querySelector(sourceSelector(rule.field)) as HTMLElement | null;\n        if (!src) return false;\n        const v = getControlValue(src);\n        return testRule(v, rule);\n    });\n    const ok = group.mode === 'all' ? results.every(Boolean) : results.some(Boolean);\n    if (window.__FB_LOGIC_DEBUG__) console.log('[fb-logic] group', group, 'results', results, 'ok?', ok);\n    return ok;\n}\n\nfunction setDisabled(el: HTMLElement, disabled: boolean) {\n    const inputs = el.querySelectorAll('input, select, textarea, button');\n    inputs.forEach((n: Element) => {\n        (n as HTMLInputElement).disabled = disabled;\n        if (disabled) (n as HTMLInputElement).required = false;\n    });\n}\n\nfunction setVisible(el: HTMLElement, visible: boolean) {\n    (el as HTMLElement).style.display = visible ? '' : 'none';\n    (el as HTMLElement).setAttribute('aria-hidden', visible ? 'false' : 'true');\n}\n\n/* ==============================\n   Actions + Targets\n============================== */\n\nfunction applyActions(target: HTMLElement, actions: LogicGroup['actions'], truthy: boolean) {\n    const shouldShow =\n        actions.includes('show') ? truthy :\n            actions.includes('hide') ? !truthy :\n                truthy;\n\n    setVisible(target, shouldShow);\n\n    if (actions.includes('disable')) setDisabled(target, true);\n    if (actions.includes('enable')) setDisabled(target, false);\n\n    if (actions.includes('require')) {\n        const inputs = target.querySelectorAll('input, select, textarea');\n        inputs.forEach((n: Element) => { (n as HTMLInputElement).required = shouldShow; });\n    }\n}\n\nfunction parseLogicAttr(el: HTMLElement): LogicConfig | null {\n    const raw = el.getAttribute('data-logic');\n    if (!raw) return null;\n    try { return JSON.parse(raw) as LogicConfig; }\n    catch {\n        if (window.__FB_LOGIC_DEBUG__) console.warn('Invalid data-logic JSON', raw, el);\n        return null;\n    }\n}\n\n/* ==============================\n   HYDRATION (Builder JSON â†’ DOM)\n============================== */\n\nfunction strifyLogic(logic: any): string | null {\n    if (!logic) return null;\n    if (typeof logic === 'string') return logic;\n    try { return JSON.stringify(logic); } catch { return null; }\n}\n\nfunction queryByNameAll(form: HTMLElement, name: string): NodeListOf<HTMLElement> {\n    const n = cssEscape(name);\n    return form.querySelectorAll<HTMLElement>(`[name=\"${n}\"], [name=\"${n}[]\"]`);\n}\n\nfunction hydrateFromFormData(form: HTMLElement, formData: any) {\n    if (!formData) return;\n    try { if (typeof formData === 'string') formData = JSON.parse(formData); } catch { return; }\n    if (!Array.isArray(formData)) return;\n\n    for (const field of formData) {\n        const name: string | undefined = field?.name;\n        if (!name) continue;\n\n        const nodes = queryByNameAll(form, name);\n        if (!nodes.length) continue;\n\n        const logicJson = strifyLogic(field.logic);\n        const applyTo: string = field.logicApplyTo || field.applyTo || 'self';\n        const groupId: string | undefined = field.logicGroup;\n\n        if (!logicJson && groupId && applyTo === 'group') {\n            nodes.forEach((el) => el.setAttribute('data-logic-group', String(groupId)));\n            continue;\n        }\n\n        if (!logicJson) continue;\n\n        if (applyTo === 'container') {\n            nodes.forEach((el) => {\n                const wrap =\n                    typeof window.FB_GET_WRAPPER === 'function'\n                        ? window.FB_GET_WRAPPER(el)\n                        : defaultWrapper(el);\n                wrap.setAttribute('data-logic-container', logicJson);\n            });\n        } else if (applyTo === 'group' && groupId) {\n            nodes.forEach((el) => el.setAttribute('data-logic-group', String(groupId)));\n        } else {\n            nodes.forEach((el) => el.setAttribute('data-logic', logicJson));\n        }\n    }\n}\n\nfunction normalizeActions(cfg: LogicConfig): LogicGroup['actions'] {\n    const a = (cfg.actions && cfg.actions.length ? cfg.actions : ['show']);\n    return a as LogicGroup['actions'];\n}\n\n/* ==============================\n   Target discovery + evaluation\n============================== */\n\nfunction findTargets(form: HTMLElement): Array<{\n    el: HTMLElement;\n    cfg: LogicConfig;\n    mode: 'self' | 'container' | 'group';\n    groupId?: string;\n}> {\n    const targets: Array<{\n        el: HTMLElement;\n        cfg: LogicConfig;\n        mode: 'self' | 'container' | 'group';\n        groupId?: string;\n    }> = [];\n\n    form.querySelectorAll('[data-logic]').forEach((el) => {\n        const cfg = parseLogicAttr(el as HTMLElement);\n        if (cfg) targets.push({ el: el as HTMLElement, cfg, mode: 'self' });\n    });\n\n    form.querySelectorAll('[data-logic-container]').forEach((el) => {\n        const raw = (el as HTMLElement).getAttribute('data-logic-container');\n        if (!raw) return;\n        try { targets.push({ el: el as HTMLElement, cfg: JSON.parse(raw) as LogicConfig, mode: 'container' }); }\n        catch { }\n    });\n\n    form.querySelectorAll('[data-logic-group]').forEach((el) => {\n        const id = (el as HTMLElement).getAttribute('data-logic-group') || '';\n        const group = window.fbLogicGroups?.[id];\n        if (group) {\n            const cfg: LogicConfig = { groups: [group], actions: group.actions, applyTo: 'group', logicGroup: id };\n            targets.push({ el: el as HTMLElement, cfg, mode: 'group', groupId: id });\n        }\n    });\n\n    if (window.__FB_LOGIC_DEBUG__) {\n        console.log('[fb-logic] targets found:', targets.length, targets);\n    }\n    return targets;\n}\n\nfunction reeval(form: HTMLElement, targets: ReturnType<typeof findTargets>, options: SetupOptions) {\n    const getWrapper = options.getWrapper || defaultWrapper;\n\n    targets.forEach((t) => {\n        const el = t.el;\n\n        let truthy = true;\n        if (t.cfg.groups && t.cfg.groups.length) truthy = t.cfg.groups.every((g) => evalGroup(form, g));\n\n        const wrapper =\n            t.mode === 'self' ? getWrapper(el) :\n                t.mode === 'container' ? el :\n                    getWrapper(el);\n\n        const actions = normalizeActions(t.cfg);\n        applyActions(wrapper, actions, truthy);\n\n        if (options.onState) options.onState(el, truthy);\n        if (window.__FB_LOGIC_DEBUG__) console.log('[fb-logic] applied', { el, mode: t.mode, actions, truthy, wrapper });\n    });\n}\n\n/* ==============================\n   Public API\n============================== */\n\nexport function setup(formEl: HTMLElement | Element, _formData?: any, options: SetupOptions = {}) {\n    const form = formEl as HTMLElement;\n\n    // --- 0) Extract Logic Groups from formData (hidden field) BEFORE target discovery\n    // We look for a hidden field named \"__logicGroups\" (or \"logicGroups\") and install it on window.\n    try {\n        if (_formData) {\n            const arr = Array.isArray(_formData)\n                ? _formData\n                : (typeof _formData === 'string' ? JSON.parse(_formData) : []);\n\n            if (Array.isArray(arr)) {\n                const grpField =\n                    arr.find((f: any) => f?.type === 'hidden' && (f?.name === '__logicGroups' || f?.name === 'logicGroups'));\n                if (grpField?.value && typeof grpField.value === 'string') {\n                    try {\n                        const parsed = JSON.parse(grpField.value);\n                        if (parsed && typeof parsed === 'object') (window as any).fbLogicGroups = parsed;\n                    } catch { /* ignore bad JSON */ }\n                }\n            }\n        }\n    } catch { /* non-fatal */ }\n\n    // --- 1) Hydrate per-field attributes (data-logic, data-logic-container, data-logic-group)\n    if (_formData) {\n        try { hydrateFromFormData(form, _formData); }\n        catch (e) { if (window.__FB_LOGIC_DEBUG__) console.warn('hydrateFromFormData failed', e); }\n    }\n\n    // --- 2) Discover targets and bind listeners\n    const targets = findTargets(form);\n\n    const watched = new Set<string>();\n    // collect all fields referenced by rules (including group rules)\n    targets.forEach((t) => {\n        const groups = (t.cfg?.groups || []) as any[];\n        groups.forEach((g) => {\n            (g.rules || []).forEach((r: any) => {\n                if (r?.field) {\n                    watched.add(r.field);\n                    // also watch array-notation variants, e.g. \"foo[]\" vs \"foo\"\n                    watched.add(String(r.field).replace(/\\[\\]$/, ''));\n                }\n            });\n        });\n    });\n\n    if (window.__FB_LOGIC_DEBUG__) console.log('[fb-logic] watching fields:', Array.from(watched));\n\n    const handler = (ev: Event) => {\n        const t = ev.target as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | null;\n        if (!t) return;\n        const nameAttr = t.name || (t.getAttribute && t.getAttribute('name')) || '';\n        if (!nameAttr) return;\n        const simple = nameAttr.replace(/\\[\\]$/, '');\n        if (watched.has(nameAttr) || watched.has(simple)) {\n            if (window.__FB_LOGIC_DEBUG__) console.log('[fb-logic] change on', nameAttr, 'â†’ reeval');\n            reeval(form, targets, options);\n        }\n    };\n\n    form.addEventListener('input', handler, true);\n    form.addEventListener('change', handler, true);\n\n    // First run\n    reeval(form, targets, options);\n\n    // Optional external refresh hook\n    form.addEventListener('fb:reinit-logic' as any, () => reeval(form, targets, options));\n\n    // expose for quick debugging from console\n    (window as any)._fbLogic = { refresh: () => reeval(form, targets, options) };\n}\n\n\nexport function refresh(formEl: HTMLElement | Element) {\n    setup(formEl);\n}\n\nexport function evaluateField(formEl: HTMLElement | Element, _name: string) {\n    setup(formEl);\n}\n"],"names":["DEFAULT_TYPES","withConditionalLogic","opts","panelTitle","types","enableVE","typeUserAttrs","t","makeVE","htmlParent","getTextArea","getApplyTo","getGroupId","ve","hdr","title","tip","veBody","modeWrap","actionsWrap","rules","footer","addBtn","save","getFieldsNow","stage","_a","inst","_b","data","_d","_c","f","v","getChoicesFor","fieldName","fm","buildFieldSelect","sel","fields","opt","buildOpSelect","forField","isNum","isChoice","ops","o","buildValueInput","current","choices","input","row","field","op","value","fSel","initialField","oSel","vWrap","renderValue","fn","val","newOps","rm","_mode","_actions","i","rulesCfg","r","cfg","ta","raw","parsed","g","acts","onOpenFieldEdit","editPanel","logicControls","section","header","body0","open","body","adv","advHeader","advBody","el","seen","ctrl","n","dupRow","dupes","idx","attachLogicGroupsManager","targetContainer","initialOrOpts","state","inferFieldsFromBuilderJson","$stage","fb","getFields","x","getValuesFor","wrapper","btn","modal","closeBtn","loadBtn","saveBtn","fromJson","advHdr","listEl","addGroupBtn","srcObj","safeParse","renderFromJson","close","e","isOpen","obj","collectFromVe","origGetData","mode","out","groupsObj","groupsStr","arr","fieldObj","addGroupBlock","txt","clearChildren","node","groupId","groupWrap","idInput","delBtn","top","modeLbl","modeSel","rulesList","addRuleBtn","addRuleRow","setOpsForField","renderValueControl","s","c","option","keys","id","result","b","actions","vEl","j","cssEscape","name","CSSObj","sourceSelector","defaultWrapper","candidates","found","getControlValue","group","rr","vals","cb","cbb","testRule","rule","expected","valStr","expStr","valNum","expNum","evalGroup","form","results","src","ok","setDisabled","disabled","setVisible","visible","applyActions","target","truthy","shouldShow","parseLogicAttr","strifyLogic","logic","queryByNameAll","hydrateFromFormData","formData","nodes","logicJson","applyTo","normalizeActions","findTargets","targets","reeval","options","getWrapper","setup","formEl","_formData","grpField","watched","handler","ev","nameAttr","simple","refresh","evaluateField","_name"],"mappings":"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"}