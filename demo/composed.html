<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Composed Demo (Builder JSON → Render + Logic)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            padding: 2rem;
        }
    </style>
</head>
<body>
    <h1>Composed Demo</h1>
    <p class="text-muted">Renders from JSON and applies conditional logic from the same JSON.</p>

    <div id="render"></div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/formBuilder@3.21.1/dist/form-render.min.js"></script>

    <script type="module">
        import { setup } from '/src/renderer/setup.ts';

        // Turn on debug logs:
        window.__FB_LOGIC_DEBUG__ = true;

        // IMPORTANT: Make sure the radio values match the rule ("yes"/"no"), or update the rule accordingly.
        const formData = [{ "type": "radio-group", "required": false, "label": "Do you have a vehicle?", "inline": false, "name": "hasVehicle", "access": false, "other": false, "logicApplyTo": "self", "values": [{ "label": "Yes", "value": "yes", "selected": false }, { "label": "No", "value": "no", "selected": true }] }, { "type": "text", "required": false, "label": "Vehicle Make", "className": "form-control", "name": "vehicleMake", "access": false, "subtype": "text", "logic": "{\n  \"groups\":[\n    {\"mode\":\"any\",\"rules\":[{\"field\":\"hasVehicle\",\"op\":\"equals\",\"value\":\"yes\"}]}\n  ],\n  \"actions\":[\"show\",\"require\"]\n}\n", "logicApplyTo": "self" }, { "type": "text", "required": false, "label": "Vehicle Model", "className": "form-control", "name": "vehicleModel", "access": false, "subtype": "text", "logic": "{\n  \"groups\":[\n    {\"mode\":\"any\",\"rules\":[{\"field\":\"hasVehicle\",\"op\":\"equals\",\"value\":\"yes\"}]}\n  ],\n  \"actions\":[\"show\",\"require\"]\n}\n", "logicApplyTo": "self" }];

        const $root = window.jQuery('#render');
        $root.formRender({ formData });      // 1) render

        // Plain-JS change logger (no TS "as" here)
        document.getElementById('render').addEventListener('change', (e) => {
            const t = e.target;
            console.log('[demo] change:', t && t.name, '→', t && t.value, 'checked?', t && t.checked);
        }, true);

        const api = setup($root[0], formData);  // 2) hydrate + bind
        window._fbLogic = api;                  // for console: _fbLogic.refresh()
    </script>
</body>
</html>
